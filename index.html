<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Redefinir senha</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <script src="https://cdn.jsdelivr.net/npm/appwrite@14.0.0"></script>

    <style>
      body {
        font-family: Arial, sans-serif;
        background: #000;
        color: #fff;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
      }

      .container {
        width: 100%;
        max-width: 400px;
        padding: 20px;
      }

      h1 {
        text-align: center;
        color: #ffd700;
      }

      input {
        width: 100%;
        padding: 12px;
        margin: 10px 0;
        border-radius: 6px;
        border: 1px solid #ffd700;
        background: #000;
        color: #fff;
      }

      button {
        width: 100%;
        padding: 12px;
        background: #ffd700;
        border: none;
        border-radius: 6px;
        font-weight: bold;
        cursor: pointer;
      }

      .msg {
        margin-top: 15px;
        text-align: center;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <h1>Nova senha</h1>

      <input
        type="password"
        id="password"
        placeholder="Digite sua nova senha"
      />

      <button onclick="resetPassword()">Confirmar</button>

      <div class="msg" id="msg"></div>
    </div>

    <script>
      // ConfiguraÃ§Ã£o do Appwrite
      const client = new Appwrite.Client()
        .setEndpoint("https://nyc.cloud.appwrite.io/v1") // ðŸ”´ ENDPOINT
        .setProject("68f65d83002fe8dd2701"); // ðŸ”´ PROJECT ID

      const account = new Appwrite.Account(client);

      // Pegando parÃ¢metros da URL
      const params = new URLSearchParams(window.location.search);
      const userId = params.get("userId");
      const secret = params.get("secret");

      const msgDiv = document.getElementById("msg");

      if (!userId || !secret) {
        msgDiv.innerText = "Link invÃ¡lido ou expirado.";
      }

      // FunÃ§Ã£o para redefinir a senha
      async function resetPassword() {
        const password = document.getElementById("password").value;

        if (!password) {
          msgDiv.innerText = "Digite a nova senha.";
          return;
        }

        try {
          // Aqui estÃ¡ a alteraÃ§Ã£o: agora usamos 4 parÃ¢metros
          await account.updateRecovery(userId, secret, password, password);

          msgDiv.innerText = "Senha redefinida com sucesso! âœ…";

          // Opcional: redirecionar apÃ³s 2 segundos
          // setTimeout(() => {
          //   window.location.href = "/login";
          // }, 2000);
        } catch (err) {
          console.error(err);
          msgDiv.innerText = "Erro ao redefinir a senha. Tente novamente.";
        }
      }
    </script>
  </body>
</html>